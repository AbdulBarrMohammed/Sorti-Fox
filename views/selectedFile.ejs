<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/indexStyles.css">
    <link rel="stylesheet" href="/fileStyle.css">
    <title>Document</title>
</head>
<body>
    <% if (user) {%>
        <header class="header">
            <div class="left-header">
                <a href="/">
                    <img src="/images/fox-4-svgrepo-com.svg">
                    <h2>SortiFox</h2>
                </a>
                <ul class="left-header-left-links">
                    <li><a href="">Products</a></li>
                    <li><a href="">Solutions</a></li>
                    <li><a href="">Enterprise</a></li>
                    <li><a href="">App</a></li>
                </ul>
            </div>
            <div class="right-header">
                <ul>
                    <li><a href="/log-out">Log out</a></li>
                    <li><div class="profile"> <p><%- user.email.charAt(0).toUpperCase() %></p> </div></li>

                </ul>
            </div>
        </header>
    <% } else { %>
        <%- include('./header.ejs') %>
    <%}%>

    <div class="content">
        <div class="image-container">

            <% if (file.path.endsWith('.pdf')) { %>
                <object data="<%= file.path %>" type="application/pdf" width="100%" height="100%">
                  </object>
            <% } else { %>
                <img class="selectedImg" id="myFile" src="<%= file.path %>" alt="<%= file.name %>" />
            <% } %>
            <div class="img-description">
                <p>Uploaded at: <%- file.createdAt %></p>
                <p>Updated at: <%- file.updatedAt %></p>
                <p>Size: <%- file.blob %></p>
                <div class="img-buttons">
                    <button id= "myFile" class="button" data-download="myFile">Download</button>
                    <button class="share-btn">Share</button>
                </div>

            </div>
        </div>

    </div>

    <script>
        let downloadLinks = document.querySelectorAll('[data-download]');

        downloadLinks.forEach(button => {
            const id = button.dataset.download
            const file = document.getElementById(id);
            const a = document.createElement('a');

            let imgPath = file.src;
            let fileName = file.alt || 'download';
            imgPath = imgPath.replace('/upload/', '/upload/fl_attachment/');

            a.href = imgPath;
            a.download = fileName;

            a.style.display = "none";


            button.addEventListener("click", () => {
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            })

        })


    </script>
</body>
</html>
